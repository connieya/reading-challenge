# 5일차 p.145 ~ 160

## 2장 테스트

스프링의 핵심인 IoC 와 DI는 오브젝트의 설계와 생성, 관계, 사용에 관한 기술이다.
스프링은 IoC / DI 를 이용해 객체지향 프로그래밍 언어의 근본과 가치를 개발자가 손쉽게 적용하고 사용할 수 있게 도와주는 기술이다.


그리고 다른 하나의 도구로 스프링이 강조하고 가치를 두고 있는 것이 바로 테스트다.

스프링으로 개발을 하면서 테스트를 만들지 않는다면 이는 스프링이 지닌 가치의
절반을 포기하는 셈이다.

### 2.1 UserDaoTest 다시 보기

#### 2.1.1 테스트의 유용성

테스트란 결국 내가 예상하고 의도했던 대로 코드가 정확히 동작하는지를 확ㅇ니해서,
만든 코드를 확신할 수 있께 해주는 작업이다.

또한 테스트의 결과가 원하는 대로 나오지 않는 경우에는 코드나
설계에 결함이 있을음 알 수 있다.


##### 2.1.2 UserDaoTest 의 특징


`리스트 2-1 main() 메소드로 작성된 테스트`

```java
public class UserDaoTest {
    public static void main(String[] args) throws SQLException, ClassNotFoundException {
        ApplicationContext context = new GenericXmlApplicationContext("applicationContext.xml");
        
        UserDao dao = context.getBean("userDao",UserDao.class);
        
        User user = new User();
        user.setId("user");
        user.setName("백기선");
        user.setPassword("married");
        
        dao.add(user);

        System.out.println(user.getId() +" 등록 성공");

        User user2 = dao.get(user.getId());
        System.out.println(user2.getName());
        System.out.println(user2.getPassword());
        

        System.out.println(user2.getId() +" 등록 성공");
        
        
    }
}

```

#### 웹을 통한 DAO 테스트 방법의 문제점


DAO 뿐만 아니라 서비스 클래스, 컨트롤러 , JSP 뷰 등 모든
레이어의 기능을 다 만들고 나서야 테스트가 가능하다는 점이 가장 큰 문제다.


하나의 테스트를 수행하는 데 참여하는 클래스와 코드가 너무 많기 때문이다.

사실 테스트하고 싶었던 건 UserDao 였는데 다른 계층의 코드와 컴포넌트,
심지어 서버의 설정 상태까지 모두 테스트에 영향을 줄 수 있기 때문에
이런 방식으로 테스트하는 것은 번거롭고, 오류가 있을 때 빠르고 정확하게 대응하기가 힘들다는 문제가 있다.

#### 작은 단위의 테스트

테스트와 관심이 다른다면 테스트할 대상을 분리하고 집중해서 접근해야 한다.

이렇게 작은 단위의 코드에 대해 테스트를 수행한 것을 단위 테스트라고 한다.

일반적으로 단위는 작을수록 좋다. 단위를 넘어서는 다른 코드들은 신경 쓰지 않고,
참여하지도 않고 테스트가 동작할 수 있으면 좋다. 

UserDao 는 서비스, MVC 계층이 참여하고 웹 화면과 서버까지 동원하지 않고도 
테스트가 가능했다. DAO 라는 기능과 DB 까지로 단위를 잡고 집중해서
테스트할 수 있었다.
그래서 UserDaoTest를 단위 테스트라고 부를 수 있다.
어떤 개발자는 테스트 중에 DB가 사용되면 단위 테스트가 아니라고도 한다.
그럼 UserDaoTest는 단위 테스트가 아니라고 봐야 할까? 그렇지는 않다.


각 단위 기능은 잘 동작하는데 묶어놓으면 안 되는 경우가 종종 발생하기 때문이다.
따라서 이런 길고 많은 단위가 참여하는 테스트도 언젠가는 필요하다.

이렇게 작은 단위로 나눠서 테스트하는 단위 테스트가 필요한 이유를 좀 더 생각해보자.
단위 테스트를 하는 이유는 개발자가 설계하고 만든 코드가 원래 의도한 대로 동작하는재를 개발자 스스로 빨리 확인받기 위해서다.


#### 자동수행 테스트 코드

그런데 애플리케이션을 구성하는  클래스 안에 테스트 코드를 포함시키는 것보다는 별도로 테스트용 클래스를 만들어서 테스트 코드르 넣는 편이 낫다.


#### 지속적인 개선과 점진적인 개발을 위한 테스트


오히려 그렇게 작은 단계를 거치는 동안 테스트를 수행해서 확신을 가지고
코드를 변경해갔기 때문에 전체적으로 코드를 개선하는 작업에 속도가 붙고 더 쉬워졌을 수도 있다.


#### 2.1.3 UserDatoTest 의 문제점


**수동 확인 작업의 번거로움**

테스트 수행은 코드에 의해 자동으로 진행되기 하지만 테스트의 결과를 확인하는 일은
사람의 책임이므로 완전히 자동으로 테스트되는 방법이라고 말할 수가 없다.

**실행 작업의 번거로움**

아무리 간단히 실행 가능한 main() 메소드라고 하더라도 매번 그것을 실행하는 것은 제법 번거롭다.

## 2.2 UserDaoTest 개선

### 2.2.1 테스트 검증의 자동화

정확히 일치한다면 모든 정보가 빠짐없이 DB에 등록됐고, 이를 다시 DB에서 정확히 가져왔다는 사실을
알 수 있다.


`리스트 2-2 수정 전 테스트 코드`


`리스트 2-3 수정 후 테스트 코드`


add()를 통한 등록 자체는 별다르게 검증할 것이 없다.
add()를 호출하고 나서 에러가 발생하지 않으면 일단 성공으로 간주한다.


`리스트 2-4 JUnit 프레임워크에서 동작할 수 있는 테스트 메서드로 전환`

main() 대신에 일반 메소드로 만들고 적절한 이름을 붙여준다.


#### 검증 코드 전환

