# 7일차 2024-04-07 p.137 ~

# DI (Dependency Injection) 와 서비스 로케이터

밥 아저씨 (Uncle Bob) 로 유명한 로버트 C 마틴 (Robert C. Martin) 은 소프트웨어를 두 개의 영역으로 구분해서 설명하고 있는데,
한 영역은 고수준 정책 및 저수준 구현을 포함한 어플리케이션 영역이고 또 다른 영역은 어플리케이션이 동작하도록 각 객체들을 연결 해 주는
메인 영역이다.


## 어플리케이션 영역과 메인 영역

간단한 비디오 포맷 변환기

- 파일의 확장자를 이용해서 비디오 파일의 포맷을 변환한다.
- 변환 요청을 등록하면 순차적으로 변환 작업을 수행한다.
  - 변환 요청 정보는 파일 또는 DB를 이용해서 보관할 수 있어야 한다.
- 비디오 형식의 변환 처리는 오픈 소스인 ffmpeg 을 이용하거나 구매 예정인 변환 솔루션을 사용할 수 있어야 한다.
- 명령 행에서 변환할 원본 파일과 변환 결과로 생성될 파일을 입력한다. 

요구 사항을 분석 해보면 핵심 기능은 다음과 같다.

- 변환 작업을 요청하면 순차적으로 변환을 처리한다.

위 기능을 제공하는 데 있어 변화가 발생하는 부분은 다음의 두 가지이다.

- 변환 요청 정보 저장 : 파일에 보관한다 또는 DB에 보관하낟.
- 변환 처리 : ffmpeg 을 사용한다 또는 솔루션을 사용한다.

![img.png](img.png)

JobQueue 와 Transcoder 는 변화되는 부분을 추상화한 인터페이스로서,  transcoder 패키지의 다른 코드에
영향을 주지 않으면서 확장할 수 있는 구조를 갖고 있다.  (즉, 개방 폐쇄 원칙을 따른다.)


JobQueue 는 파일을 이용하는 구현과 DB를 이용하는 구현의 두 가지가 제공되며,
Transcoder 역시 ffmpeg과 솔루션을 이용하는 두 가지 버전의 구현이 제공된다.

JobQueue 와 Transcoder 를 구현한 콘크리트 클래스들은 이 두 인터페이스를 상속 받아 구현하였기 때문에,
Worker 클래스는 이들 콘크리트 클래스에 의존하지 않는다.


```java
public class Locator {
    private static Locator instance;
    public static Locator getInstance(){
        return instance;
    }
    
    public static void init(Locator locator) {
        instance = locator;
    }
    
    private JobQueue jobQueue;
    private Transcoder transcoder;

    public Locator(JobQueue jobQueue, Transcoder transcoder) {
        this.jobQueue = jobQueue;
        this.transcoder = transcoder;
    }

    public JobQueue getJobQueue() {
        return jobQueue;
    }

    public Transcoder getTranscoder() {
        return transcoder;
    }
}

```


Locator 클래스는 Worker 와 JobCLI가 사용할 JobQueue 객체와 Transcoder 객체를 제공하는 기능을 정의하고 있다.


Locator 객체를 이용해서 JobQueue 객체와 Transcoder 객체를 설정해 주면, Worker와 JobCLI 는 설정한 객체를 사용하게 된다.

그러면 과연 누가 Locator 객체를 초기화 해줄 것인가? 그리고 JobCLI 객체와 Worker 객체를 생성하고 실행 해 주는 건 누구인가?

메인 영역은 다음 작업을 수행한다.

- 어플리케이션 영역에서 사용될 객체를 생성한다.
- 각 객체 간의 의존 관계를 설정한다.
- 어플리케이션을 실행한다.